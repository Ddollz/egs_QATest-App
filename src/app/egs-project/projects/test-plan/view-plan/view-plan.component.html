<div class="container-sfluid app__content">
    <div class="row">
        <div class="col-lg-12">
            <div class="view-plan-header">
                <div class="view-plan-header-title">
                
                    <h2 class="page-title my-3">
                        <a routerLink="/projects/plan">
                            <i class="submenu-toggle bi bi-arrow-left"></i>
                        </a>
                        {{TestPlan_Title}}
                    </h2>
                </div>
    
                <div class="view-plan-header-buttons mt-3">
                    <div class="start-run">
                        <button type="button" class="btn btn-primary" routerLink="/projects/run/create">
                            Start run
                        </button>
                    </div>
                    
                    
                    <div class="dropdown">
                        <button class="btn btn-secondary" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="bi bi-three-dots"></i>
                        </button>
                        <div class="dropdown-menu dropdown-menu-end">
                            <!-- <div class="dropdown-item">
                                <a routerLink="/projects/plan/editplan/{{i}}">Edit</a>
                            </div> -->
                            <div class="dropdown-item">
                                <a routerLink="/projects/plan/editplan/">Edit</a>
                            </div>
                            <div class="dropdown-item">
                                <a href="#">Export XLS</a>
                            </div>
                            <!-- <div class="dropdown-item" (click)="openDeleteModal(element.TestPlan_ID, element.TestPlan_Title)">
                                <a class="text-danger">Delete</a>
                            </div> -->
                            <div class="dropdown-item">
                                <a class="text-danger">Delete</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Nav Tabs -->
            <div class="col-xl">
                <div class="card">
                    <div class="card-body pt-3">
                        <ul class="nav nav-tabs nav-tabs-bordered" id="myTabs">
                            <li class="nav-item">
                                <button class="nav-link active" id="tabBtn1" data-bs-toggle="tab" data-bs-target="#tab1">Details</button>
                            </li>

                            <li class="nav-item">
                                <button class="nav-link" id="tabBtn2" data-bs-toggle="tab" data-bs-target="#tab2">Test Cases</button>
                            </li>

                            <li class="nav-item">
                                <button class="nav-link" id="tabBtn3" data-bs-toggle="tab" data-bs-target="#tab3">Test Runs</button>
                            </li>
                        </ul>

                        <!-- Tab Content -->

                        <!-- Details -->

                        <div class="tab-content pt-2">
                            <div id="tab1" class="tab-pane show active">
                                <div class="plan-view-details">
                                    <div class="plan-view-details-item">
                                        <p class="view-plan-details-item-header">Description</p>
                                        <div class="markdown-area">
                                            <div>
                                                <div style="overflow-wrap: break-word;">
                                                    <p>{{TestPlan_Desc}}</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Test Cases -->
                            <!-- <div id="tab2" class="tab-pane">
                                <div class="filters-block">
                                    <div class="filters-block-items">
                                        <div class="case-search-input me-2">
                                            <input type="text" name="title" class="form-control form-control-sm" placeholder="Search for test cases" value="">
                                        </div>
                                    </div>
                                    <div class="add-filter-outer">
                                        <button class="add-filter-button">+ Add filter</button>
                                    </div>
                                </div>

                                <div class="cases-content mt-2">
                                    <div class="cases-header-title">
                                        Cases
                                    </div>
                                    <div class="row">
                                        <table mat-table [dataSource]="casesDataSource" class="mat-elevation-z0">

                                            <ng-container matColumnDef="Title">
                                              <th mat-header-cell *matHeaderCellDef>Title</th>
                                              <td mat-cell *matCellDef="let testCase of testCases" (click)="openCasePanel($event, testCase)">{{testCase.Case_Title}}</td>
                                            </ng-container>

                                        
                                            <ng-container matColumnDef="Assignee">
                                              <th mat-header-cell *matHeaderCellDef>Assignee</th>
                                              <td mat-cell *matCellDef="let testCase of testCases" (click)="openCasePanel($event, testCase)">
                                                <span>Unassigned</span>
                                              </td>
                                            </ng-container>
                                            
                                            <ng-container matColumnDef="Expected_Duration">
                                              <th mat-header-cell *matHeaderCellDef>Expected Duration</th>
                                              <td mat-cell *matCellDef="let testCase of testCases" (click)="openCasePanel($event, testCase)">0:00:00</td>
                                            </ng-container>
                            
                                            <tr mat-header-row *matHeaderRowDef="casesColumns"></tr>
                                            <tr mat-row *matRowDef="let row; columns: casesColumns;" class="cases-row"></tr>
                                          </table>
                                    </div>
                                </div>
                            </div> -->
                            <div id="tab2" class="row casesTable tab-pane">
                              <div class="filters-block">
                                <div class="filters-block-items">
                                    <div class="case-search-input me-2">
                                        <input type="text" name="title" class="form-control form-control-sm" placeholder="Search for test cases" value="">
                                    </div>
                                </div>
                                <div class="add-filter-outer">
                                    <button class="add-filter-button">+ Add filter</button>
                                </div>
                              </div>

                              <div class="cases-content mt-2">
                              <ng-container *ngFor="let item of finalCaseDataSource | keyvalue: originalOrder">
                  
                                <ng-container *ngFor="let o of  suites; let i = index">
                                  <ng-container *ngIf="o.Suite_ID.toString() === item.key.toString()">
                  
                                    <div class="d-flex align-items-center text-center" type="button" data-bs-toggle="collapse" [attr.data-bs-target]="'#collapse-'+item.key" aria-expanded="false" aria-controls="collapseExample" (click)="collapseChevronIcon($event)">
                                      <div class="run-suite-header-title">{{o.Suite_Name}}
                                        <a class="run-suite-header-collapse">
                                          <i class="bi bi-chevron-down"></i>
                                        </a>
                                      </div>
                                    </div>
                  
                                    <ng-container *ngFor="let snl of SuiteName_List | keyvalue: originalOrder">
                                      <ng-container *ngFor="let name of snl.value | keyvalue: originalOrder">
                                        <div class="run-suite-crumbs" *ngIf="o.Suite_ID.toString() === name.key.toString()">
                                          {{name.value}}
                                        </div>
                                      </ng-container>
                                    </ng-container>
                                  </ng-container>
                  
                                </ng-container>
                  
                  
                                <div [id]="'collapse-'+item.key" class="show row">

                                  <table mat-table [dataSource]="item.value" class="mat-elevation-z0 mb-3">
                                    <ng-container matColumnDef="Title">
                                      <th mat-header-cell *matHeaderCellDef>Title</th>
                                      <td mat-cell *matCellDef="let element">
                                        {{element.Case_Title}}</td>
                                    </ng-container>
                                    <ng-container matColumnDef="Assignee">
                                      <th mat-header-cell *matHeaderCellDef>Assignee</th>
                                      <td mat-cell *matCellDef="let element">
                                        <div *ngIf="element.User_Firstname && element.User_Lastname">
                                          <!-- <img class="assignee-img" src="../../assets/img/placeholder.jpg"> -->
                                          <span>{{element.User_Firstname}} {{element.User_Lastname}}</span>
                                        </div>
                                      </td>
                                    </ng-container>
                                    <ng-container matColumnDef="TimeSpent">
                                      <th mat-header-cell *matHeaderCellDef>Time spent</th>
                                      <td mat-cell *matCellDef="let element">
                                        <ng-container *ngIf="element.Date_Started && element.Date_Ended">
                                          {{element.Date_Started | date :"HH:MM:ss"}} <br> {{element.Date_Ended | date :"HH:MM:ss"}}
                                        </ng-container>
                                      </td>
                                    </ng-container>
                                    <tr mat-header-row *matHeaderRowDef="casesColumns"></tr>
                                    <tr (click)="openCasePanel($event, testCase)" mat-row *matRowDef="let row; let testCase of testCases; columns: casesColumns;" class="cases-row"></tr>
                                  </table>
                                </div>
                              </ng-container>
                            </div>
                            </div>

                            <!-- Test Runs -->
                            <div id="tab3" class="tab-pane profile-overview">
                                <div class="filters-block">
                                    <div class="filters-block-items">
                                        <div class="case-search-input me-2">
                                            <input type="text" name="title" class="form-control form-control-sm" placeholder="Search for test runs" value="">
                                        </div>
                                    </div>
                                    <div class="add-filter-outer">
                                        <button class="add-filter-button">+ Add filter</button>
                                    </div>
                                </div>
                                <!-- <app-test-run></app-test-run> -->
                                <!-- <div class="row mt-2 px-2">
                                  <table mat-table [dataSource]="viewRunDataSource" class="mat-elevation-z0">
                                    <ng-container matColumnDef="Status">
                                      <th mat-header-cell *matHeaderCellDef></th>
                                      <td mat-cell *matCellDef="let element">
                                        <ng-template [ngIf]="element.TestRun_Status == 0">
                                          <i class="bi bi-record-circle-fill"></i>
                                        </ng-template>
                                        <ng-template [ngIf]="element.TestRun_Status == 1">
                                          <i class="bi bi-check-circle-fill"></i>
                                        </ng-template>
                                        <ng-template [ngIf]="element.TestRun_Status == 2">
                                          <i class="bi bi-x-circle-fill"></i>
                                        </ng-template>
                                      </td>
                                    </ng-container>
                          
                                    <ng-container matColumnDef="Title">
                                      <th mat-header-cell *matHeaderCellDef>Title</th>
                                      <td mat-cell *matCellDef="let element">
                                        <div class="column-title" routerLink="/projects/run/dashboard/{{element.TestRun_ID}}">{{element.TestRun_Title}}</div>
                                        <div class="column-subtitle">Started at {{formatDate(element.TestRun_DateCreated)}}</div>
                                      </td>
                                    </ng-container>
                          
                                    <ng-container matColumnDef="Environment">
                                      <th mat-header-cell *matHeaderCellDef>Environment</th>
                                      <td mat-cell *matCellDef="let element"></td>
                                    </ng-container>
                          
                                    <ng-container matColumnDef="Time">
                                      <th mat-header-cell *matHeaderCellDef>Time</th>
                                      <td mat-cell *matCellDef="let element">00:00:00</td>
                                    </ng-container>
                          
                                    <ng-container matColumnDef="Progress">
                                      <th mat-header-cell *matHeaderCellDef>Status</th>
                                      <td mat-cell *matCellDef="let element">
                                        <div class="progress">
                                          <div class="progress-bar passed-pb" matTooltip="Passed" [style.width.%]="(element.TestRun_Passed/element.TestRun_CaseCount)*100">{{element.TestRun_Passed}}</div>
                                          <div class="progress-bar failed-pb" matTooltip="Failed" [style.width.%]="(element.TestRun_Failed/element.TestRun_CaseCount)*100">{{element.TestRun_Failed}}</div>
                                          <div class="progress-bar blocked-pb" matTooltip="Blocked" [style.width.%]="(element.TestRun_Blocked/element.TestRun_CaseCount)*100">{{element.TestRun_Blocked}}</div>
                                          <div class="progress-bar invalid-pb" matTooltip="Invalid" [style.width.%]="(element.TestRun_Invalid/element.TestRun_CaseCount)*100">{{element.TestRun_Invalid}}</div>
                                          <div class="progress-bar skipped-pb" matTooltip="Skipped" [style.width.%]="(element.TestRun_Skipped/element.TestRun_CaseCount)*100">{{element.TestRun_Skipped}}</div>
                                          <div class="progress-bar untested-pb" matTooltip="Untested" [style.width.%]="(element.TestRun_Untested/element.TestRun_CaseCount)*100">{{element.TestRun_Untested}}</div>
                                        </div>
                                      </td>
                                    </ng-container>
                          
                                    <ng-container matColumnDef="ThreeDots">
                                      <th mat-header-cell *matHeaderCellDef></th>
                                      <td mat-cell *matCellDef="let element; let i = index">
                                        <div class="d-flex justify-content-end">
                                          <button class="btn three-dots" data-bs-toggle="dropdown">
                                            <i class="bi bi-three-dots"></i>
                                            <div class="dropdown-menu">
                                              <div class="dropdown-item" routerLink="/projects/run/dashboard/{{element.TestRun_ID}}">Dashboard</div>
                                              <div class="dropdown-item" routerLink="/projects/run/dashboard/{{element.TestRun_ID}}">Open Wizard</div>
                                              <div class="dropdown-item">Clone run</div>
                                              <div class="dropdown-item" routerLink="/projects/run/edit/{{element.TestRun_ID}}">Edit run</div>
                                              <div class="dropdown-item" (click)="openDeleteModal(element.TestRun_ID, element.TestRun_Title)" data-bs-toggle="modal" data-bs-target="#deleteModal">Delete</div>
                                            </div>
                                          </button>
                                        </div>
                                      </td>
                                    </ng-container>
                          
                                    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                                    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                          
                                    <tr class="mat-row" *matNoDataRow>
                                      <td class="mat-cell" [attr.colspan]="displayedColumns.length">
                                        Looks like you don’t have any test runs yet.
                                      </td>
                                    </tr>
                                  </table>
                          
                                  <ng-template [ngIf]="viewRunDataSource.filteredData.length > 5">
                                  <mat-paginator [pageSizeOptions]="[10, 5, 20, 50]"></mat-paginator>
                                  </ng-template>
                                </div> -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Delete Modal -->
            <div class="modal fade" id="deleteModal" tabindex="-1">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-body p-4">
                
                        <h5 class="modal-title mb-3">Delete Test Plan</h5>
                        <p class="mb-4">Are you sure, that you want to delete test plan "{{TestPlan_Title}}"?</p>
                
                        <div class="d-flex align-items-center justify-content-end">
                            <span class="cancel-span me-2" data-bs-dismiss="modal">Cancel</span>
                            <button type="button" class="btn btn-primary" (click)="deleteTestPlan()">Delete</button>
                        </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<!-- Case Panel -->
<div class="CasePanel" #casePanel>
    <div class="row">
        <div class="col-11">
            <div class="mb-1">
                <span class="project-title">{{case_Desc}}</span>
            </div>
            <h2 class="page-title mb-2">{{case_Name}}</h2>
        </div>
        <div class="col d-flex justify-content-end">
            <i class="bi bi-x-lg" (click)="closeCasePanel()"></i>
        </div>
    </div>

    <ul class="nav nav-tabs nav-tabs-bordered-small">
        <li class="nav-item">
            <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#generalTab">General</button>
        </li>
        <li class="nav-item">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#propertiesTab">Properties</button>
        </li>
        <li class="nav-item">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#runsTab">Runs</button>
        </li>
        <li class="nav-item">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#historyTab">History</button>
        </li>
        <li class="nav-item">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#defectsPanelTab">Defects</button>
        </li>
        <li class="nav-item">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#commentsTab">Comments</button>
        </li>
    </ul>

    <div class="tab-content">

    <!-- General Tab -->
    <div class="panel-general tab-pane show active" id="generalTab">
        <section class="mt-3">
            <label for="0-description" class="panelLabel">Description</label>
            <div class="markdown-area">
              {{case_Desc}}
            </div>
          </section>
          <section class="mt-3">
            <label for="0-precondition" class="panelLabel">Pre-conditions</label>
            <div class="markdown-area">
              {{case_PreCon}}
            </div>
          </section>
          <section class="mt-3">
            <label for="0-postcondition" class="panelLabel">Post-conditions</label>
            <div class="markdown-area">
              {{case_PostCon}}
            </div>
          </section>
  
          <section class="mt-3">
            <label for="0-postcondition" class="panelLabel">Attachments</label>
            <div class="d-flex flex-wrap">
  
              <ng-container *ngFor="let attachment of testCaseAttachment">
                <ng-container *ngIf="attachment.byteFile.contentType.split('/')[0] == 'image'; else notImage">
  
                  <div class="suitecase-attachment">
                    <div class="suitecase-attachment-container">
                      <div class="suitecase-attachment-image" (click)="downloadFile(attachment.Attachment_ID,attachment.Filename)" style="background: url(&quot;data:image/png;base64,{{attachment.byteFile.fileContents}}&quot;)">
                        <a class="suitecase-attachment-link is-image"></a>
                        <div class="suitecase-attachment-overlay">
                          <p class="suitecase-attachment-filename">{{attachment.Filename}}</p>
                          <div class="suitecase-attachment-overlay-bottom">
                            <p class="suitecase-attachment-size"> {{attachment.Filesize}}</p>
                            <button type="button" class="suitecase-attachment-remove"><i class="bi bi-x"></i></button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
  
                </ng-container>
                <ng-template #notImage>
  
  
                  <div class="suitecase-attachment">
                    <div class="suitecase-attachment-container">
                      <div data-disable="false" class="suitecase-attachment-file" (click)="downloadFile(attachment.Attachment_ID,attachment.Filename)">
                        <a class="suitecase-attachment-link"></a>
                        <span class="suitecase-attachment-extension">{{attachment.byteFile.contentType.split('/')[0]}}</span>
                        <div class="suitecase-attachment-overlay">
                          <p class="suitecase-attachment-filename">{{attachment.Filename}}</p>
                          <div class="suitecase-attachment-overlay-bottom">
                            <p class="suitecase-attachment-size"> {{attachment.Filesize}}</p>
                            <button type="button" class="suitecase-attachment-remove"><i class="bi bi-x"></i></button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </ng-template>
              </ng-container>
  
            </div>
  
  
          </section>
          <section class="mt-3">
            <label for="0-steps" class="panelLabel">Steps</label>
            <div class="row">
            <table mat-table [dataSource]="stepdataSource" class="mat-elevation-z0 table-steps">
              <ng-container matColumnDef="Step">
                <th mat-header-cell *matHeaderCellDef> Step </th>
                <td mat-cell *matCellDef="let element">
                  <div class="markdown-area">{{element.Step_number}}</div>
                </td>
              </ng-container>
              <ng-container matColumnDef="Action">
                <th mat-header-cell *matHeaderCellDef> Action </th>
                <td mat-cell *matCellDef="let element">
                  <div class="markdown-area">{{element.Step_Action}}</div>
                </td>
              </ng-container>
              <ng-container matColumnDef="Input">
                <th mat-header-cell *matHeaderCellDef> Input Data </th>
                <td mat-cell *matCellDef="let element">
                  <div class="markdown-area">{{element.Step_InputData}}</div>
                </td>
              </ng-container>
              <ng-container matColumnDef="Expected">
                <th mat-header-cell *matHeaderCellDef> Expected Result </th>
                <td mat-cell *matCellDef="let element">
                  <div class="markdown-area">{{element.Step_ExpectedResult}}</div>
                  <div class="attachments attachments-small">
                    <ng-container *ngFor="let a of stepAttachments">
                      <ng-container *ngIf="a.Step_ID == element.Case_StepID">
                        <ng-container *ngIf="a.byteFile.contentType.split('/')[0] == 'image'; else notImage">
                          <div class="attachment">
                            <a href="" target="_blank" rel="noreferrer">
                              <div class="attachment-image" [ngStyle]="{'background': 'url(&quot;data:image/png;base64,'+a.byteFile.fileContents+'&quot;)'}"></div>
                            </a>
                          </div>
                        </ng-container>
                      </ng-container>
  
                      <ng-template #notImage>
                        <div class="attachment">
                          <a href="#" target="_blank" rel="noreferrer">
                            <div class="attachment-file"><span class="attachment-extension">{{a.byteFile.contentType.split('/')[0]}}</span></div>
                          </a>
                        </div>
                      </ng-template>
  
                    </ng-container>
                  </div>
                </td>
              </ng-container>
              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
            </table>
            </div>
          </section>
    </div>

    <!-- Properties Tab -->
    <div class="tab-pane show" id="propertiesTab">
        <div class="row mt-3">

            <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12 form-group">
              <label class="panelLabel">Severity</label>
              <mat-select class="select-item" [(ngModel)]="Case_Severity" (ngModelChange)="onChangePanel('@Case_Severity',$event)">
                <mat-option value="1" class="select-item">
                  Not set
                </mat-option>
                <mat-option value="2" class="select-item">
                  Blocker
                </mat-option>
                <mat-option value="3" class="select-item">
                  Critical
                </mat-option>
                <mat-option value="4" class="select-item">
                  Major
                </mat-option>
                <mat-option value="5" class="select-item">
                  Normal
                </mat-option>
                <mat-option value="6" class="select-item">
                  Minor
                </mat-option>
                <mat-option value="7" class="select-item">
                  Trival
                </mat-option>
              </mat-select>
            </div>
  
            <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12 form-group">
              <label class="panelLabel">Priority</label>
              <mat-select class="select-item" [(ngModel)]="Case_Priority" (ngModelChange)="onChangePanel('@Case_Priority',$event)">
                <mat-option value="1" class="select-item">
                  Not set
                </mat-option>
                <mat-option value="2" class="select-item">
                  High
                </mat-option>
                <mat-option value="3" class="select-item">
                  Medium
                </mat-option>
                <mat-option value="4" class="select-item">
                  Low
                </mat-option>
              </mat-select>
            </div>
  
            <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12 form-group">
              <label class="panelLabel">Type</label>
              <mat-select class="select-item" [(ngModel)]="Case_Type" (ngModelChange)="onChangePanel('@Case_Type',$event)">
                <mat-option value="Other" class="select-item">
                  Other
                </mat-option>
                <mat-option value="Functional" class="select-item">
                  Functional
                </mat-option>
                <mat-option value="Smoke" class="select-item">
                  Smoke
                </mat-option>
                <mat-option value="Regression" class="select-item">
                  Regression
                </mat-option>
                <mat-option value="Security" class="select-item">
                  Security
                </mat-option>
                <mat-option value="Usability" class="select-item">
                  Usability
                </mat-option>
                <mat-option value="Performance" class="select-item">
                  Performance
                </mat-option>
                <mat-option value="Acceptance" class="select-item">
                  Acceptance
                </mat-option>
                <mat-option value="Compatibility" class="select-item">
                  Compatibility
                </mat-option>
                <mat-option value="Integration" class="select-item">
                  Integration
                </mat-option>
                <mat-option value="Exploratory" class="select-item">
                  Exploratory
                </mat-option>
              </mat-select>
            </div>
  
            <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12 form-group">
              <label class="panelLabel">Layer</label>
              <mat-select class="select-item" [(ngModel)]="Case_Layer" (ngModelChange)="onChangePanel('@Case_Layer',$event)">
                <mat-option value="1" class="select-item">
                  Not set
                </mat-option>
                <mat-option value="2" class="select-item">
                  E2E
                </mat-option>
                <mat-option value="3" class="select-item">
                  API
                </mat-option>
                <mat-option value="4" class="select-item">
                  Unit
                </mat-option>
              </mat-select>
            </div>
  
            <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12 form-group">
              <label class="panelLabel">Is flaky</label>
              <mat-select class="select-item" [(ngModel)]="Case_Flaky" (ngModelChange)="onChangePanel('@Case_Flaky',$event)">
                <mat-option value="1" class="select-item">
                  No
                </mat-option>
                <mat-option value="2" class="select-item">
                  Yes
                </mat-option>
              </mat-select>
            </div>
  
            <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12 form-group">
              <label class="panelLabel">Milestone</label>
              <mat-select class="select-item" [(ngModel)]="Case_Milestone" (ngModelChange)="onChangePanel('@Case_Milestone',$event)">
                <mat-option value="1" class="select-item">
                  Not set
                </mat-option>
              </mat-select>
            </div>
  
            <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12 form-group">
              <label class="panelLabel">Behavior</label>
              <mat-select class="select-item" [(ngModel)]="Case_Behavior" (ngModelChange)="onChangePanel('@Case_Behavior',$event)">
                <mat-option value="1" class="select-item" selected>
                  Not set
                </mat-option>
                <mat-option value="2" class="select-item">
                  Positive
                </mat-option>
                <mat-option value="3" class="select-item">
                  Negative
                </mat-option>
                <mat-option value="4" class="select-item">
                  Destructive
                </mat-option>
              </mat-select>
            </div>
  
            <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12 form-group">
              <label class="panelLabel">Automation status</label>
              <mat-select class="select-item" [(ngModel)]="Case_AutoStat" (ngModelChange)="onChangePanel('@Case_AutoStat',$event)">
                <mat-option value="1" class="select-item" selected>
                  Not automated
                </mat-option>
                <mat-option value="2" class="select-item">
                  To be automated
                </mat-option>
                <mat-option value="3" class="select-item">
                  Automated
                </mat-option>
              </mat-select>
            </div>
          </div>
    </div>

    <!-- Runs Tab -->
    <div class="tab-pane show" id="runsTab">
        <div class="mt-1 p-1">
            <div class="row">
                <table mat-table [dataSource]="runDataSource" class="mat-elevation-z0 panelTable">
                    <ng-container matColumnDef="title">
                    <th mat-header-cell *matHeaderCellDef> Title </th>
                    <td mat-cell *matCellDef="let element">
                        <div class="column-title">{{element.title}}</div>
                        <div class="column-subtitle">{{element.datestart}}</div>
                    </td>
                    </ng-container>
        
                    <ng-container matColumnDef="environment">
                    <th mat-header-cell *matHeaderCellDef> Environment </th>
                    <td mat-cell *matCellDef="let element"> {{element.environment}} </td>
                    </ng-container>
        
                    <ng-container matColumnDef="time">
                    <th mat-header-cell *matHeaderCellDef> Time </th>
                    <td mat-cell *matCellDef="let element"> {{element.time}} </td>
                    </ng-container>
        
                    <ng-container matColumnDef="status">
                    <th mat-header-cell *matHeaderCellDef> Status </th>
                    <td mat-cell *matCellDef="let element">
                        <div class="progress">
                        <div class="progress-bar" role="progressbar" aria-label="Example with label" [ngStyle]="{'width.%': element.status }" attr.aria-valuenow="{{element.status}}" aria-valuemin="0" aria-valuemax="100">{{element.status}}%</div>
                        </div>
                    </td>
                    </ng-container>
                    <tr mat-header-row *matHeaderRowDef="runDisplayedColumns"></tr>
                    <tr mat-row *matRowDef="let row; columns: runDisplayedColumns;"></tr>
        
                    <tr *matNoDataRow="">
                    <td class="mat-cell" colspan="4"> No run result yet. </td>
                    </tr>
                </table>
            </div>
        </div>
    </div>

    <!-- History Tab -->
    <div class="panel-history tab-pane show" id="historyTab">
      <ul class="nav nav-tabs nav-tabs-bordered-small">
        <li class="nav-item">
            <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#descTab">Description</button>
        </li>
        <li class="nav-item">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#attachmentsTab">Attachments</button>
        </li>
        <li class="nav-item">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#stepsTab">Steps</button>
        </li>
      </ul>
      <!-- <div class="panelNav sub" #panelNavsub>
        <button (click)="changeSubPanelContent('Descriptions')" class="btns active" id="Descriptions"><span> </span>Descriptions</button>
        <button (click)="changeSubPanelContent('Attachments')" class="btns" id="Attachments"><span> </span>Attachments</button>
        <button (click)="changeSubPanelContent('Steps')" class="btns" id="Steps"><span></span>Steps</button>
      </div> -->
      <div class="tab-content">
        <div class="tab-pane show active" id="descTab">
          <div>
            <ng-container *ngFor="let item of displayHistoryData; let i = index; last as isLast; first as isFirst">
              <app-testcase-history [currentObj]="item" [prevObj]="displayHistoryData[i-1]" [index]="i" [isFirst]="isFirst" [isLast]="isLast" [testCase]="testCases">
              </app-testcase-history>
            </ng-container>
          </div>
          <ng-container *ngIf="displayHistoryDataNumber != this.testCase_History.length && displayHistoryDataNumber <= this.testCase_History.length ">
            <button class="btn btn-secondary mt-5" (click)="showMoreHistory('1')">Show More</button>
          </ng-container>

          <ng-container *ngIf="displayHistoryDataNumber >= this.testCase_History.length">
            <app-testcase-history [noChanges]="true" [testCase]="testCases">
            </app-testcase-history>
          </ng-container>
        </div>
        <div class="tab-pane show" id="attachmentsTab">
          <div class="d-flex align-content-center mt-3">
            <div class="revision-body">
              <div class="element mt-3">
                <div class="d-flex" style="align-items: baseline;">
                  <div class="element-before justify-content-center">
                    Current/Added
                  </div>
                  <div class="element-divider ms-3 me-3">=</div>
                  <div class="element-after justify-content-center">
                    Updated/Deleted
                  </div>
                </div>
                <p class="element-title"></p>
                <div class="d-flex" style="align-items: baseline;">
                  <div class="element-before">
                    <ng-container *ngFor="let tCA of testCaseAttachment">
                      <div class="attachments attachments-small-half">
                        <ng-container *ngIf="tCA.byteFile.contentType.split('/')[0] == 'image'; else notImage">
                          <div class="attachment">
                            <a href="" target="_blank" rel="noreferrer">
                              <div class="attachment-image" [ngStyle]="{'background': 'url(&quot;data:image/png;base64,'+tCA.byteFile.fileContents+'&quot;)'}"></div>
                            </a>
                          </div>
                        </ng-container>

                        <ng-template #notImage>
                          <div class="attachment">
                            <a href="#" target="_blank" rel="noreferrer">
                              <div class="attachment-file"><span class="attachment-extension">{{tCA.byteFile.contentType.split('/')[0]}}</span></div>
                            </a>
                          </div>
                        </ng-template>
                      </div>
                    </ng-container>
                  </div>
                  <div class="element-divider ms-3 me-3"><i class="bi bi-arrow-right-short"></i></div>
                  <div class="element-after">
                    <ng-container *ngFor="let tCA of testCase_HistoryAttachment">
                      <div class="attachments attachments-small-half">
                        <ng-container *ngIf="tCA.byteFile.contentType.split('/')[0] == 'image'; else notImage">
                          <div class="attachment">
                            <a href="" target="_blank" rel="noreferrer">
                              <div class="attachment-image" [ngStyle]="{'background': 'url(&quot;data:image/png;base64,'+tCA.byteFile.fileContents+'&quot;)'}"></div>
                            </a>
                          </div>
                        </ng-container>

                        <ng-template #notImage>
                          <div class="attachment">
                            <a href="#" target="_blank" rel="noreferrer">
                              <div class="attachment-file"><span class="attachment-extension">{{tCA.byteFile.contentType.split('/')[0]}}</span></div>
                            </a>
                          </div>
                        </ng-template>
                      </div>
                    </ng-container>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- <ng-container *ngIf="displayHistoryDataAttachmentNumber != testCase_HistoryAttachment.length && displayHistoryDataAttachmentNumber <= testCase_HistoryAttachment.length ">
            <button class="btn btn-secondary mt-5" (click)="showMoreHistory('2')">Show More</button>
          </ng-container> -->

        </div>
        <div class="Steps tab-pane show" id="stepsTab">
          <ng-container *ngFor="let item of stepHistoryDisplay; let i = index; last as isLast; first as isFirst">
            <!-- <ng-container *ngIf="checkPrev(item)"> -->

            <div class="d-flex align-content-center mt-3">
              <div class="align-self-start me-2"><img class="lazy avatar-sm" src="../../../../assets/img/placeholder.jpg"></div>
              <div class="revision-body">
                <div class="history-user">
                  <div class="history-username">
                    <span style="font-weight: bold;">Rica Isidto</span>
                  </div>
                  <div class="history-role">{{item.SysStartTime | date :"yyyy-MM-dd HH:MM:ss"}}</div>
                </div>
                <div class="element mt-3">
                  <p class="element-title">Updated Step No. {{item.Step_number}}
                    <!-- - {{item.Case_StepID}}-->
                  </p>
                  <div class="d-flex" style="align-items: baseline;">

                    <table class="table">
                      <thead>
                        <tr>
                          <th scope="col">#</th>
                          <th scope="col">Action</th>
                          <th scope="col">Input Data</th>
                          <th scope="col">Expected Result</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td scope="row">{{item.Step_number}}</td>
                          <td>{{item.Step_Action}}</td>
                          <td>{{item.Step_InputData}}</td>
                          <td>{{item.Step_ExpectedResult}}</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
            <!-- </ng-container> -->

          </ng-container>


          <ng-container *ngIf="stepHistoryLimit != stepHistory.length && stepHistoryLimit <= stepHistory.length ">
            <button class="btn btn-secondary mt-5" (click)="showMoreHistory('3')">Show More</button>
          </ng-container>
        </div>
      </div>
    </div>

    <!-- Defects Tab -->
    <div class="tab-pane show" id="defectsPanelTab">
        <div class="mt-1 p-1">
            <div class="row">
            <table mat-table [dataSource]="defectsDataSource" class="mat-elevation-z0 panelTable">
                <ng-container matColumnDef="Defect">
                  <th mat-header-cell *matHeaderCellDef>Defect</th>
                  <td mat-cell *matCellDef="let element">
                  </td>
                </ng-container>
      
                <ng-container matColumnDef="Author">
                  <th mat-header-cell *matHeaderCellDef>Author</th>
                  <td mat-cell *matCellDef="let element">
                  </td>
                </ng-container>
      
                <ng-container matColumnDef="Assignee">
                  <th mat-header-cell *matHeaderCellDef>Assignee
                  <th>
                  <td mat-cell *matCellDef="let element">
                    <span>No test runs</span>
                  </td>
                </ng-container>
      
                <ng-container matColumnDef="Severity">
                  <th mat-header-cell *matHeaderCellDef>Severity</th>
                  <td mat-cell *matCellDef="let element">
                  </td>
                </ng-container>
      
                <ng-container matColumnDef="Milestone">
                  <th mat-header-cell *matHeaderCellDef>Milestone</th>
                  <td mat-cell *matCellDef="let element">
                  </td>
                </ng-container>
      
                <ng-container matColumnDef="External">
                  <th mat-header-cell *matHeaderCellDef>External</th>
                  <td mat-cell *matCellDef="let element">
                  </td>
                </ng-container>
      
                <ng-container matColumnDef="ThreeDots">
                  <th mat-header-cell *matHeaderCellDef></th>
                  <td mat-cell *matCellDef="let element">
                    <div class="d-flex justify-content-end">
                      <button class="btn three-dots" data-bs-toggle="dropdown">
                        <i class="bi bi-three-dots"></i>
                        <div class="dropdown-menu">
                          <div class="dropdown-Tag">View</div>
                          <div class="dropdown-Tag">Assign to me</div>
                          <div class="dropdown-Tag">In Progress</div>
                          <div class="dropdown-Tag">Resolve</div>
                          <div class="dropdown-Tag">Invalid</div>
                          <div class="dropdown-Tag">Edit</div>
                          <div class="dropdown-Tag">Delete</div>
                        </div>
                      </button>
                    </div>
                  </td>
                </ng-container>
      
                <tr *matNoDataRow="">
                  <td class="mat-cell" colspan="7"> No defects yet. </td>
                </tr>
      
                <tr mat-header-row *matHeaderRowDef=" defectsDisplayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: defectsDisplayedColumns;"></tr>
              </table>
            </div>
        </div>
    </div>

    <!-- Comments Tab -->
    <div class="tab-pane show" id="commentsTab">
        <div class="mt-1 p-1">
            <div class="d-flex align-items-center  mt-3 ">
                <div class=" me-2"><img class="lazy avatar-sm" src="../../../../assets/img/placeholder.jpg"></div>
                <div class="comment-user">
                  <div class="comment-username">Rica Isidto</div>
                  <div class="comment-role">Software Quality Assurance Analyst</div>
      
                </div>
                <button id="addComment" class="btn btn-primary" style="margin-left: auto;" (click)="postComment()">Send</button>
              </div>
              <div class="mt-1">
                <quill-editor [styles]="{width: '100%'}" [modules]="editorOptions" (onContentChanged)="commentContent($event)">
      
                </quill-editor>
              </div>
      
              <div class="mt-4">
                <ng-container *ngFor="let comment of caseComments">
                  <div class="d-flex w-100 mt-3">
                    <div class="me-2 comment-avatar">
                      <img class="lazy avatar-sm" src="../../../../assets/img/placeholder.jpg">
                    </div>
                    <div class="d-flex flex-column w-100">
                      <div class="comment-user">
                        <div class="comment-username">{{comment.User_Firstname}} {{comment.User_Lastname}}</div>
                        <div class="comment-role">{{comment.RoleTitle}}</div>
                      </div>
                      <quill-view (onEditorCreated)="displayCommentContent($event, comment.Comment_Content)" [modules]="{}"> </quill-view>
                      <div class="comment-date">{{comment.Comment_Date}}</div>
                    </div>
                  </div>
                </ng-container>
      
              </div>
        </div>
    </div>

    </div><!-- TAB CONTENT -->
</div>
